define(["jquery","core/config","core/str","block_readaloudteacher/readaloudhighcharts"],function(a,b,c){"use strict";var d,e,f,g,h={},i='"Open Sans",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"',j=function(a){var b="";return a.point.isDrillDown||a.point.isUserChart?b+='<div class="text-center mt-1">'+a.point.label+"</div>":(b+='<div class="text-center mt-1"><img src="'+a.point.photoUrl+'" class="userpicture defaultuserpic" role="presentation" width="50" height="50"></div><div class="text-center mt-1">'+a.point.name+'</div><div class="text-center mt-1">'+a.point.label+"</div>",b+='<div class="text-center mt-1">'+h.clickformore+"</div>"),b},k=function(c,k,l,m,n){var o={chart:{type:void 0===n?"column":n},title:{text:k[0].name,useHTML:!0},xAxis:{type:"category",labels:{rotation:90,style:{fontSize:"11px",fontFamily:i,width:"200px",whiteSpace:"nowrap",color:"#898989"}}},yAxis:{min:0,title:{text:l},plotLines:[]},legend:{floating:!0,layout:"vertical",align:"left",verticalAlign:"top",x:60,y:0},tooltip:{useHTML:!0,backgroundColor:"#f5f5f5",borderColor:"#8c8c8c",borderRadius:10,borderWidth:2,formatter:function(){return j(this)}},series:k,plotOptions:{series:{cursor:"pointer",states:{hover:{enabled:!1}}},showInLegend:0}};if("readingscompleted"===n?o.plotOptions.series.point={events:{click:function(a){location.href=b.wwwroot+"/blocks/readaloudteacher/klasses/userreports.php?userid="+a.point.xid+"&courseid="+e+"&returnklassid="+f+"&returnklasstype="+g}}}:void 0!==m&&m&&(o.drilldown={series:m,type:"line"},o.chart.events={drilldown:function(a){var b='<img src="'+a.point.photoUrl+'" class="userpicture defaultuserpic" role="presentation" width="50" height="50">';this.setTitle({text:b+a.point.name})},drillup:function(a){this.setTitle({text:a.seriesOptions.name})}}),"wpm"===n){var p=a("#pagedata").attr("data-wpmbenchmarks");if(void 0!==p){p=JSON.parse(p);var q="<b>"+h.benchmarks+"</b>: ";p.forEach(function(a){"0"!==a.value&&(o.yAxis.plotLines.push({color:"lightblue",value:a.value,dashStyle:"dash",width:"2",zIndex:5,label:{text:a.name,align:"right",x:-5}}),q+=a.name+" "+a.value+" "+h.wpm+" | ")}),o.subtitle={text:q}}}"quiz"!==n&&"accuracy"!==n||(o.yAxis.max=100),d.chart(c,o)},l=function(b){var c=[],d=a(".highcharts-data").not(".drilldown-dataseries").map(function(b,c){return c=a(c),void 0!==c&&void 0!==c.attr("data-highcharts-data")?{id:c.attr("id"),chartclass:c.attr("data-chart-class"),seriestype:c.attr("data-series-type"),json:JSON.parse(c.attr("data-highcharts-data"))}:{}});return d.each(function(a,d){"readingscompleted"===d.chartclass||b?c[d.chartclass]=d:c[d.chartclass+"-"+d.seriestype]=d}),c},m=function(){var b=[],c=a(".drilldown-dataseries").map(function(b,c){return c=a(c),void 0!==c&&void 0!==c.attr("data-highcharts-data")?{id:c.attr("id"),chartclass:c.attr("data-chart-class"),data:JSON.parse(c.attr("data-highcharts-data"))}:{}});return c.each(function(a,c){"readingscompleted"!==c.chartclass&&(void 0===b[c.chartclass]&&(b[c.chartclass]=[]),b[c.chartclass].push({id:c.id,type:c.data.type,name:c.data.name,data:c.data.data,fillColor:c.data.fillColor}))}),b};return{init:function(i,j,n){require.config({packages:[{name:"highcharts",main:"highcharts"}],paths:{highcharts:b.wwwroot+"/blocks/readaloudteacher/plugins/highcharts/code"}}),e=i,f=j.id,g=j.type,require(["highcharts","highcharts/modules/exporting","highcharts/modules/accessibility","highcharts/modules/drilldown"],function(b,e,f,g){d=b,a(document).ready(function(){e(b),f(b),g(b),c.get_strings([{key:"clickformore",component:"block_readaloudteacher"},{key:"percent",component:"block_readaloudteacher"},{key:"colwpm",component:"block_readaloudteacher"},{key:"readingscompleted",component:"block_readaloudteacher"},{key:"benchmarks",component:"block_readaloudteacher"}]).done(function(a){h.clickformore=a[0],h.percent=a[1],h.wpm=a[2],h.readingscompleted=a[3],h.benchmarks=a[4];var b=l(n);if(n)k("highchart-wpm",[b.wordsperminute.json],h.wpm,[],"wpm"),k("highchart-quiz",[b.quiz.json],h.percent,[],"quiz"),k("highchart-accuracy",[b.accuracy.json],h.percent,[],"accuracy");else{var c=m();k("highchart-readings-completed",[b.readingscompleted.json],h.readingscompleted,[],"readingscompleted"),k("highchart-wpm",[b["wordsperminute-average"].json,b["wordsperminute-latest"].json],h.wpm,c.wordsperminute,"wpm"),k("highchart-accuracy",[b["accuracy-average"].json,b["accuracy-latest"].json],h.percent,c.accuracy,"accuracy"),k("highchart-quiz",[b["quiz-average"].json,b["quiz-latest"].json],h.percent,c.quiz,"quiz")}})})})}}});